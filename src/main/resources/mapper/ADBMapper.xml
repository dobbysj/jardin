<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.javalec.ex.dao.ADBMtmDao">

	<!-- 1:1문의, 공지사항 -->

	<!-- Dto 객체 선언 -->
	<resultMap type="com.javalec.ex.dto.MtmUserDto" id="MtmUserDto">
	    <result column="rownum" property="rownum"/>	
	    <result column="iu_title" property="iu_title"/>
	    <result column="iu_date" property="iu_date"/>
	    <result column="iu_status" property="iu_status"/>
	    <result column="iu_num" property="iu_num"/>	    
	    
	    <result column="iu_sort" property="iu_sort"/>	    
	    <result column="iu_content" property="iu_content"/>	
	    <result column="iu_img" property="iu_img"/>	      	    
	    
	    <collection property="memDto" resultMap="MemberDto"/>	    
	</resultMap>
	
	<resultMap type="com.javalec.ex.dto.MemberDto" id="MemberDto">
	    <result column="m_id" property="m_id"/>
	</resultMap>
	
		<resultMap type="com.javalec.ex.dto.AdminDto" id="AdminDto">
	    <result column="ad_num" property="ad_num"/>
	    <result column="ad_id" property="ad_id"/>	 
	    <result column="ad_pw" property="ad_pw"/>
	    <result column="ad_name" property="ad_name"/> 	     	      
	    <result column="ad_grade" property="ad_grade"/>  		      
	</resultMap>
	
	<resultMap type="com.javalec.ex.dto.MtmAnswerDto" id="MtmAnswerDto">
	    <result column="ia_num" property="ia_num"/>
	    <result column="ia_content" property="ia_content"/>
	    <result column="ia_date" property="ia_date"/>    
	</resultMap>
	
	<resultMap type="com.javalec.ex.dto.AllDto" id="AllDto">
		<collection property="admindto" resultMap="AdminDto"/>	     
	    <collection property="mtmanswerdto" resultMap="MtmAnswerDto"/>	  
	    <collection property="noticedto" resultMap="NoticeDto"/>	    	     
	</resultMap>	
		
	<resultMap type="com.javalec.ex.dto.NoticeDto" id="NoticeDto">
	    <result column="rownum" property="rownum"/>		
	    <result column="no_num" property="no_num"/>	      	    
	    <result column="ad_num" property="ad_num"/>	
	    <result column="no_title" property="no_title"/>	
	    <result column="no_content" property="no_content"/>	
	    <result column="no_date" property="no_date"/>	
	    <result column="no_hit" property="no_hit"/>		
	</resultMap>
	
	<!--  1:1문의 전체 리스트 불러오기-->
	<select id="getAllBoards" resultMap="MtmUserDto">
		select rownum, mem.m_id, iu_title, iu_date, iu_status, iu_num, iu_sort, iu_content, iu_img
		from mtm_inqury_user_tb mtm, member_tb mem 
		where mem.m_num=mtm.m_num order by iu_num desc
	</select>

	<!-- 1:1문의 글 삭제 -->
	<delete id="deleteUserBoard">
		delete from mtm_inqury_user_tb where iu_num=#{param1}
	</delete>	
	
	<!-- 1:1 답변 1개 불러오기 -->
	<select id="getAnswerBoard" resultMap="AllDto">
		select ia_num, ia_content, ia_date, ad.ad_num, ad.ad_id, ad.ad_grade 
		from mtm_inqury_answer_tb mtm, admin_tb ad
		where mtm.ad_num=ad.ad_num and mtm.iu_num=#{iu_num}
	</select>
	
	<!-- 1:1 답변 1개 등록 -->
	<insert id="insertAnswerBoard">
		insert into mtm_inqury_answer_tb values(ia_seq.nextval, #{iu_num}, #{ad_num}, #{ia_content}, sysdate)
	</insert>
	
	<!-- 1:1 문의글 상태 '답변완료'로 바꾸기 -->
	<update id="updateStatusFinish">
		update mtm_inqury_user_tb set iu_status='답변완료' where iu_num=#{iu_num}
	</update>

	<!-- 1:1 답변 1개 삭제 -->
	<delete id="deleteAnswerBoard">
		delete from mtm_inqury_answer_tb where ia_num=#{ia_num}
	</delete>

	<!-- 1:1 문의글 상태 '답변대기'로 바꾸기 -->
	<update id="updateStatusWait">
		update mtm_inqury_user_tb set iu_status='답변대기' where iu_num=#{iu_num}
	</update>

	<!-- 1:1문의 답변 1개 수정 -->
	<update id="modifyAnswerBoard">
		update mtm_inqury_answer_tb set ia_content=#{ia_content} where ia_num=#{ia_num}
	</update>

	<!-- 공지사항 전체 리스트 불러오기 -->

	<select id="getAllNoticeBoards" resultMap="AllDto">
		select rownum, ad_id, ad_grade, ad.ad_num, no_num, no_title, no_content, no_date, no_hit 
		from admin_tb ad, notice_tb no where ad.ad_num=no.ad_num order by no_num desc
	</select>	

	<!-- 공지사항 새글 1개 등록 -->
	<insert id="insertNoticeBoard">
		insert into notice_tb values(n_seq.nextval,#{ad_num},#{no_title}, 
		#{no_content}, sysdate, 0)
	</insert>	
	
	<!-- 공지글 1개 불러오기 -->
	<select id="getNoticeBoard" resultMap="AllDto">
		select no_title, no_content, no_num, ad.ad_num, ad.ad_id, ad.ad_grade 
		from notice_tb noti, admin_tb ad
		where noti.ad_num=ad.ad_num and noti.no_num=#{no_num}		
	</select>
	
	<!-- 공지글 1개 수정 -->
	<update id="modifyNoticeBoard" >
		update notice_tb set no_title=#{no_title}, no_content=#{no_content} where no_num=#{no_num}	
	</update>
	
	<!-- 공지글 삭제 -->
	<delete id="deleteNoticeBoard">
		delete from notice_tb where no_num=#{no_num}
	</delete>		
	
</mapper>